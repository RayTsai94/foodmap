{% extends 'base.html' %}
{% load static %}

{% block title %}智能營養顧問 - NCU 食物地圖{% endblock %}

{% block content %}
<div class="container">
    <h1 class="mb-4">智能營養顧問</h1>
    <p class="lead mb-4">向AI諮詢您的飲食、營養和健康問題</p>
    
    <div class="row">
        <div class="col-lg-7">
            <!-- 問答區塊 -->
            <div class="card mb-5">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">向AI提問</h4>
                </div>
                <div class="card-body">
                    <form method="get" action="{% url 'ai_advisor' %}">
                        <div class="mb-3">
                            <label for="question" class="form-label">請輸入您的問題</label>
                            <div class="input-group mb-3">
                                <input type="text" class="form-control" id="question" name="question" 
                                    placeholder="例如：怎樣健康減肥？或 哪些食物富含蛋白質？" 
                                    value="{{ question }}" required>
                                <button class="btn btn-primary" type="submit">
                                    <i class="fas fa-paper-plane me-2"></i>詢問
                                </button>
                            </div>
                            <div class="form-text">您可以詢問飲食建議、營養知識、食物搭配等問題</div>
                        </div>
                    </form>
                    
                    {% if response %}
                        <div class="ai-response mt-4">
                            <h4 class="d-flex align-items-center">
                                <i class="fas fa-robot text-primary me-2"></i>AI回答：
                            </h4>
                            <div class="card p-4 mb-4 border-0 bg-light rounded-3">
                                <div class="response-content">
                                    {{ response|linebreaks }}
                                </div>
                            </div>
                        </div>
                    {% endif %}
                    
                    <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
                        <a href="{% url 'ai_food_analysis' %}" class="btn btn-outline-primary">
                            <i class="fas fa-utensils me-2"></i>分析我的食物
                        </a>
                        <a href="{% url 'user_food_record' %}" class="btn btn-outline-primary">
                            <i class="fas fa-book me-2"></i>查看我的食物記錄
                        </a>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-5">
            <!-- 其他功能區塊 -->
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h4 class="mb-0">營養顧問功能</h4>
                </div>
                <div class="card-body">
                    <div class="list-group mb-3">
                        <a href="{% url 'ai_food_analysis' %}" class="list-group-item list-group-item-action d-flex align-items-center">
                            <i class="fas fa-chart-pie text-primary me-3 fa-lg"></i>
                            <div>
                                <h5 class="mb-1">食物營養分析</h5>
                                <p class="mb-0 text-muted small">分析您食物的營養成分與健康建議</p>
                            </div>
                        </a>
                        <a href="{% url 'user_food_record' %}" class="list-group-item list-group-item-action d-flex align-items-center">
                            <i class="fas fa-calendar-alt text-success me-3 fa-lg"></i>
                            <div>
                                <h5 class="mb-1">食物記錄管理</h5>
                                <p class="mb-0 text-muted small">記錄和追蹤您的飲食習慣</p>
                            </div>
                        </a>
                        <a href="{% url 'nutrition_dashboard' %}" class="list-group-item list-group-item-action d-flex align-items-center">
                            <i class="fas fa-tachometer-alt text-warning me-3 fa-lg"></i>
                            <div>
                                <h5 class="mb-1">營養儀表板</h5>
                                <p class="mb-0 text-muted small">查看營養摘要和統計數據</p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
            
            <!-- 常見問題區塊 -->
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h4 class="mb-0">熱門問題</h4>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        <a href="{% url 'ai_advisor' %}?question=有哪些方法可以健康減肥" 
                           class="list-group-item list-group-item-action">
                            <i class="fas fa-angle-right me-2"></i>有哪些方法可以健康減肥？
                        </a>
                        <a href="{% url 'ai_advisor' %}?question=高蛋白食物有哪些" 
                           class="list-group-item list-group-item-action">
                            <i class="fas fa-angle-right me-2"></i>高蛋白食物有哪些？
                        </a>
                        <a href="{% url 'ai_advisor' %}?question=素食者如何確保營養均衡" 
                           class="list-group-item list-group-item-action">
                            <i class="fas fa-angle-right me-2"></i>素食者如何確保營養均衡？
                        </a>
                        <a href="{% url 'ai_advisor' %}?question=糖尿病患者的飲食原則" 
                           class="list-group-item list-group-item-action">
                            <i class="fas fa-angle-right me-2"></i>糖尿病患者的飲食原則是什麼？
                        </a>
                        <a href="{% url 'ai_advisor' %}?question=運動前後應該吃什麼" 
                           class="list-group-item list-group-item-action">
                            <i class="fas fa-angle-right me-2"></i>運動前後應該吃什麼？
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    {% if recommendations %}
        <!-- 推薦菜單區塊 -->
        <div class="analysis-card mb-5">
            <h2 class="mb-4">相關推薦菜單</h2>
            <p>根據您的問題，我們為您推薦以下菜單項目：</p>
            
            <div class="row">
                {% for item in recommendations %}
                    <div class="col-md-4 mb-4">
                        <div class="card h-100">
                            {% if item.image %}
                                <img src="{{ item.image.url }}" class="card-img-top" alt="{{ item.name }}">
                            {% else %}
                                <img src="{% static 'img/default-food.jpg' %}" class="card-img-top" alt="{{ item.name }}">
                            {% endif %}
                            <div class="card-body">
                                <h5 class="card-title">{{ item.name }}</h5>
                                <p class="card-text text-muted">{{ item.restaurant.name }}</p>
                                <div class="d-flex justify-content-between align-items-center">
                                    {% if item.nutrition %}
                                        <span class="badge bg-success">{{ item.nutrition.calories }} 卡路里</span>
                                    {% else %}
                                        <span class="badge bg-secondary">無營養信息</span>
                                    {% endif %}
                                    <a href="{% url 'menu_item_detail' item.pk %}" class="btn btn-sm btn-primary">查看詳情</a>
                                </div>
                                {% if item.nutrition %}
                                <div class="mt-3">
                                    <div class="d-flex justify-content-between small">
                                        <span>蛋白質: {{ item.nutrition.protein }}g</span>
                                        <span>碳水: {{ item.nutrition.carbs }}g</span>
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
    
    <!-- 免責聲明 -->
    <div class="alert alert-warning mt-5">
        <div class="d-flex">
            <div class="me-3">
                <i class="fas fa-exclamation-triangle fa-2x"></i>
            </div>
            <div>
                <h5>免責聲明</h5>
                <p class="mb-0">
                    智能營養顧問提供的建議僅供參考，不構成醫療建議。如有特殊健康需求或疾病，請諮詢專業醫生或營養師。
                    AI回答基於現有知識生成，可能存在不完整或不準確的情況。
                </p>
            </div>
        </div>
    </div>
</div>
{% endblock %} 